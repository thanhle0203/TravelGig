package com.thanhle.service;

import java.util.List;
import java.util.Set;
import java.util.HashSet;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.thanhle.domain.Building;
import com.thanhle.domain.Room;
import com.thanhle.repository.BuildingRepository;
import com.thanhle.repository.RoomRepository;

public class IBuildingService implements BuildingService {
	
	@Autowired
	BuildingRepository buildingRepository;
	
	@Autowired
	RoomRepository roomRepository;

	public Building saveBuilding(Building building) {
		Building persistedBuilding = buildingRepository.findByBuName(building.getBuName());
		if (persistedBuilding == null) {
			Set<Room> roomList = building.getRoomList();
			Set<Room> roomPersistList = new HashSet<>();
			for (Room room : roomList) {
				Room persistRoom = roomRepository.save(room);
				roomPersistList.add(persistRoom);
			}
			building.setRoomList(roomPersistList);
			buildingRepository.save(building);
		}
		else {
			Set<Room> roomList = building.getRoomList();
			Set<Room> roomPersistList = persistedBuilding.getRoomList();
			for (Room room : roomList) {
				if (roomRepository.findByRoomType(room.getRoomType()) == null) {
					Room persistRoom = roomRepository.save(room);
					roomPersistList.add(persistRoom);
				}
				else {
					Room persistedRoom = roomRepository.findByRoomType(room.getRoomType());
					persistedRoom.setRoomSize(room.getRoomSize());
					Room savedRoom = roomRepository.save(persistedRoom);
					roomPersistList.add(savedRoom);
				}
			}
			building.setRoomList(roomPersistList);
			buildingRepository.save(persistedBuilding);
		}
		return building;
	}

	public List<Building> getBuildingByRoomType(String roomType) {
		// TODO Auto-generated method stub
		return buildingRepository.findByRoomList_RoomType(roomType);
	}

}
