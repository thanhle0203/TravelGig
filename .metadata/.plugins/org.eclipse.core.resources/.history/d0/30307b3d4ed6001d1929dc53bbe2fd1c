package com.thanhle.service;

import java.util.List;
import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.thanhle.domain.Building;
import com.thanhle.domain.Room;
import com.thanhle.repository.BuildingRepository;

@Service
public class IBuildingService implements BuildingService {

	@Autowired
	private BuildingRepository buildingRepository;

	@Override
	@Transactional
	public Building saveBuilding(Building building) {
		// Check if building with the given name already exists in the database
		Optional<Building> existingBuilding = Optional.of(buildingRepository.findByBuName(building.getBuName()));
		
		if (existingBuilding.isPresent()) {
			// Update the existing building with new room sizes and types
			Building updatedBuilding = existingBuilding.get();
			updatedBuilding.getRoomList().addAll(building.getRoomList());
			return buildingRepository.save(updatedBuilding);
		} else {
			// Save a new building along with its room sizes and types
			return buildingRepository.save(building);
		}
	}

	@Override
	public Building getBuildingByName(String buName) {
		Optional<Building> building = Optional.of(buildingRepository.findByBuName(buName));
		return building.orElse(null);
	}

	@Override
	public List<Building> getAllBuildings() {
		return buildingRepository.findAll();
	}
}
